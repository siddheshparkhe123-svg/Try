# controllers/pan_controller.py
from flask import request, jsonify
from flask_restful import Resource
from services.pan_service import fetch_pan_details
from models import PANRequest
from pydantic import ValidationError

class PANVerification(Resource):
    def post(self):
        try:
            # Parse JSON body
            data = request.get_json()
            
            # Validate with Pydantic model
            pan_request = PANRequest(**data)

            results = []
            for item in pan_request.input_data:
                result = fetch_pan_details(
                    pan=item.pan,
                    consent=item.consent,
                    case_id=item.case_id
                )
                results.append(result)

            return jsonify({"results": results})

        except ValidationError as e:
            return jsonify({"error": e.errors()})
